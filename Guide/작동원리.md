# 📖 ASCII Doom 작동 원리 (상세 가이드)

이 문서는 **ASCII Doom**이 웹 브라우저에서 어떻게 돌아가는지, 그 내부 원리를 비전공자도 이해할 수 있도록 상세한 비유와 함께 설명합니다.

---

## 1. 개요: 둠을 텍스트로?

1993년작 고전 게임 **Doom(둠)**을 웹 브라우저에서 실행하되, 우리가 아는 점(픽셀) 화면 대신 **문자(ASCII 텍스트)**로 변환하여 보여주는 프로젝트입니다.
마치 "매트릭스" 영화 속 세상처럼, 게임 속 모든 장면이 글자들의 흐름으로 표현됩니다.

---

## 2. 핵심 기술: 3가지 마법의 기둥

이 프로젝트가 가능한 이유는 크게 세 가지 기술이 맞물려 돌아가기 때문입니다.

### ① 보이지 않는 게임기 (WASM & Chocolate Doom)
브라우저 뒤편에는 사실 **진짜 게임기**가 숨어 있습니다.
*   **Chocolate Doom**: 원래 컴퓨터에 설치해서 해야 하는 C++ 기반의 둠 게임 엔진입니다.
*   **Emscripten (번역가)**: C++ 언어를 브라우저가 알아들을 수 있는 언어(**WebAssembly**)로 번역해 주는 도구입니다.
*   **결과**: 별도 프로그램 설치 없이, 크롬이나 사파리 같은 브라우저 안에서 고성능 게임 엔진이 쌩쌩 돌아갑니다.

### ② 화면 훔쳐보기 (메모리 공유)
게임기가 화면을 만들어내면, 우리는 그 화면을 모니터에 바로 띄우지 않고 **중간에 가로챕니다.**
*   **공유 메모리 (Magic Billboard)**: C++(게임기)과 자바스크립트(웹 화면)가 서로 대화하기 위해 거대한 칠판을 하나 공유합니다.
*   게임기가 매 순간 게임 화면(픽셀 데이터)을 이 칠판에 그리면, 자바스크립트가 잽싸게 그 데이터를 읽어갑니다.

### ③ 텍스트 변환 (ASCII 렌더링)
가져온 그림 데이터를 **문자**로 바꿉니다. 이 과정이 이 프로젝트의 핵심입니다.

---

## 3. 작동 과정 (파이프라인) 상세 분석

매 1초마다 35번씩 일어나는 이 복잡한 과정을 단계별로 뜯어보겠습니다.

### 1단계: 해상도 압축 (Downsampling)
*   원래 둠 게임 화면은 **320x200** 크기의 점들로 이루어져 있습니다.
*   하지만 문자는 점보다 크기 때문에, 이를 가로 **240자**, 세로 **80줄**의 문자판으로 축소해야 합니다.
*   이 과정에서 여러 개의 점을 하나로 뭉개서 평균 색을 구하는데, 이때 **"적분 영상"**이라는 고급 수학 기술을 씁니다. (아래 심화 섹션 참고)

### 2단계: 밝기 측정 및 문자 매칭
각 칸의 밝기를 0부터 255까지의 숫자로 계산한 뒤, 가장 어울리는 문자를 찾습니다.
*   **사용하는 문자들**: ` ` (공백) `.` `:` `-` `=` `+` `*` `#` `%` `@`
*   **매칭 규칙**:
    *   **밝기 0 (칠흑 같은 어둠)** -> `@` (가장 꽉 찬 문자)
    *   **밝기 128 (중간)** -> `+` 또는 `=`
    *   **밝기 255 (눈부신 빛)** -> ` ` (가장 비어 있는 문자)
*   *특이점*: 보통은 어두울수록 빈 문자를 쓰지만, 여기서는 반전된 배경을 고려하여 **어두울수록 꽉 찬 문자**를 써서 더 선명하게 보이게 했습니다.

### 3단계: 색상 복원
단지 흑백 문자만 보여주는 게 아닙니다. 원본 게임의 **색감(Color)**을 그대로 가져옵니다.
*   각 문자에 `style="color: rgb(R, G, B)"`를 입혀서, 둠 특유의 붉은 피나 초록색 독극물 바닥의 느낌을 생생하게 살립니다.

---

## 4. 🔍 심화: 0.1초의 지연도 허용하지 않는 최적화 요령

실시간 게임이기 때문에 조금이라도 계산이 늦어지면 화면이 뚝뚝 끊깁니다. 이를 막기 위해 사용된 "엔지니어의 묘수"들입니다.

### ① 적분 영상 (Integral Image) 기법
*   **문제**: 수십만 개의 점을 매번 처음부터 더하고 나누면 컴퓨터가 힘들어합니다.
*   **해결**: 미리 **"누적 합계표"**를 만들어 듭니다.
*   **비유**: 1월부터 12월까지의 가계부를 쓸 때, '현재까지 총지출'을 미리 다 계산해 두는 것입니다. 그러면 "3월부터 9월까지 쓴 돈은?"이라는 질문에, (9월 누적 - 2월 누적) 뺄셈 딱 한 번으로 답을 구할 수 있습니다.

### ② 감마 보정 (Gamma Correction)
*   **문제**: 문자로 그림을 그리면 픽셀 사이사이의 검은 여백 때문에, 원래 게임보다 훨씬 어둡고 칙칙해 보입니다.
*   **해결**: 일부러 밝기를 시원하게 올려줍니다 (**감마값 0.35**). 이렇게 해야 우리 눈에는 "원래 둠 화면과 비슷하다"고 느껴집니다.

### ③ 룩업 테이블 (Look-Up Table)
*   **문제**: 매번 "이 밝기엔 무슨 문자지?" 하고 수학 공식을 돌리면 느립니다.
*   **해결**: **"컨닝 페이퍼(정답표)"**를 0부터 255까지 쫙 만들어 둡니다.
*   컴퓨터는 계산보다 **표에서 찾기**를 훨씬 잘합니다. 밝기 숫자만 딱 보면 0.0000001초 만에 문자가 튀어나옵니다.

### ④ SIMD (Single Instruction, Multiple Data)
*   **비유**: **"팔 4개 달린 로봇"**
*   일반적인 처리가 한 손으로 점을 하나하나 옮기는 것이라면, **SIMD** 기술은 팔 4개로 한 번에 점 4개씩 휙휙 처리하는 것입니다. 이 기술 덕분에 웹에서도 끊김 없는 부드러운 화면이 가능합니다.

---

## 5. 키보드는 어떻게 연결되나요? (Input Bridging)

여러분이 브라우저에서 `↑` `↓` `←` `→` 키를 누르면 무슨 일이 일어날까요?
1.  **브라우저(JS)**가 키 입력을 감지합니다.
2.  이 신호를 **공유 메모리**를 통해 **C++ 게임기**에 전달합니다. ("야, 사용자가 앞으로 가고 싶대!")
3.  게임기는 이 신호를 받아서 게임 속 주인공을 움직입니다.
4.  주인공이 움직인 새로운 화면이 다시 1~3단계를 거쳐 문자로 변환되어 여러분 눈앞에 나타납니다.

---

## 6. 요약

이 프로젝트는 **고전 게임(Chocolate Doom)**을 **최신 웹 기술(WebAssembly)**로 포장하고, **수학적 기교(적분영상, SIMD)**를 더해 **예술적 형태(ASCII)**로 재탄생시킨 결과물입니다.
