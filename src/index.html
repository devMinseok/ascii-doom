<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <title>DOOM_ASCII — TERMINAL</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="container" class="noselect">
      <div class="monitor-header">
        <span></span>
        <span>DOOM_ASCII // VER 1.0.0</span>
      </div>

      <div class="screen-wrapper">
        <canvas id="sdl-canvas" style="display:none; width:240px; height:80px;"></canvas>
        <canvas class="frame" id="canvas" oncontextmenu="event.preventDefault()" tabindex="-1"></canvas>
        <div class="crt-overlay"></div>
        <div class="crt-glare"></div>
      </div>

      <pre id="ascii-output"></pre>

      <div class="monitor-footer">
        SYSTEM: ONLINE | RENDERER: ASCII_WASM |
        <button id="engine-toggle" class="control-button control-button--engine">ENGINE: C++</button>
        <button id="simd-toggle" class="control-button control-button--simd">SIMD: ON</button>
        <button id="benchmark-toggle" class="control-button control-button--benchmark">BENCHMARK: OFF</button>
      </div>

      <div id="benchmark-panel">
        <h3>BENCHMARK MODE</h3>
        <div id="benchmark-current-mode">Testing: SIMD ON</div>
        <div id="benchmark-cpp-stats">
          <div class="benchmark-stats">
            <h4>SIMD ON</h4>
            <div class="stat-row"><span class="stat-label">Current FPS:</span><span class="stat-value" id="bench-simd-on-fps-current">0.00</span></div>
            <div class="stat-row"><span class="stat-label">Latency (Avg):</span><span class="stat-value" id="bench-simd-on-latency-avg">0.00 ms</span></div>
            <div class="stat-row"><span class="stat-label">Latency (Min):</span><span class="stat-value" id="bench-simd-on-latency-min">0.00 ms</span></div>
            <div class="stat-row"><span class="stat-label">Latency (Max):</span><span class="stat-value" id="bench-simd-on-latency-max">0.00 ms</span></div>
          </div>
          <div class="benchmark-stats">
            <h4>SIMD OFF</h4>
            <div class="stat-row"><span class="stat-label">Current FPS:</span><span class="stat-value" id="bench-simd-off-fps-current">0.00</span></div>
            <div class="stat-row"><span class="stat-label">Latency (Avg):</span><span class="stat-value" id="bench-simd-off-latency-avg">0.00 ms</span></div>
            <div class="stat-row"><span class="stat-label">Latency (Min):</span><span class="stat-value" id="bench-simd-off-latency-min">0.00 ms</span></div>
            <div class="stat-row"><span class="stat-label">Latency (Max):</span><span class="stat-value" id="bench-simd-off-latency-max">0.00 ms</span></div>
          </div>
        </div>
        <div id="benchmark-js-stats" style="display:none;">
          <div class="benchmark-stats">
            <h4>JavaScript</h4>
            <div class="stat-row"><span class="stat-label">Current FPS:</span><span class="stat-value" id="bench-js-fps-current">0.00</span></div>
            <div class="stat-row"><span class="stat-label">Latency (Avg):</span><span class="stat-value" id="bench-js-latency-avg">0.00 ms</span></div>
            <div class="stat-row"><span class="stat-label">Latency (Min):</span><span class="stat-value" id="bench-js-latency-min">0.00 ms</span></div>
            <div class="stat-row"><span class="stat-label">Latency (Max):</span><span class="stat-value" id="bench-js-latency-max">0.00 ms</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- chocolate-doom.js (emscripten output) -->
    <script async type="text/javascript" src="chocolate-doom.js"></script>
    <!-- renderer.js (ASCII rendering logic) -->
    <script type="text/javascript" src="renderer.js"></script>

    <script>
      // Emscripten module
      var Module = {
        onRuntimeInitialized: () => {
          const sdlCanvas = document.getElementById("sdl-canvas");
          if (sdlCanvas) sdlCanvas.style.display = "none";
          // 다른 캔버스도 숨기고 우리가 쓰는 것만 보이게
          document.querySelectorAll("canvas").forEach(c => { if (c.id !== "canvas") c.style.display = "none"; });
          setTimeout(setupRenderer, 100);
        },
        noInitialRun: true,
        preRun: () => {
          Module.FS.createPreloadedFile("", "doom1.wad", "doom1.wad", true, true);
          Module.FS.createPreloadedFile("", "default.cfg", "default.cfg", true, true);
        },
        printErr: function (text) { if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(" "); console.error(text); },
        print:    function (text) { },
        setStatus:function (text) { },
        canvas: document.getElementById("sdl-canvas"),
      };

      window.onerror = function (event) { console.error("Unhandled error:", event); };
    </script>
  </body>
</html>